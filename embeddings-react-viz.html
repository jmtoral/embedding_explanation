<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tokens, Embeddings & ReAct ‚Äî Visualizaci√≥n T√©cnica</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Sora:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0c14;
    --surface: #111622;
    --surface2: #1a2035;
    --accent: #00e5ff;
    --accent2: #ff6b6b;
    --accent3: #a8ff78;
    --accent4: #ffd93d;
    --text: #e8eaf6;
    --text-dim: #7986cb;
    --border: rgba(0,229,255,0.15);
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Sora', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }
  
  /* Grid background */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: 
      linear-gradient(rgba(0,229,255,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,229,255,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }

  .container {
    max-width: 1100px;
    margin: 0 auto;
    padding: 40px 24px;
    position: relative;
    z-index: 1;
  }

  header {
    text-align: center;
    margin-bottom: 60px;
  }
  header .tag {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--accent);
    letter-spacing: 4px;
    text-transform: uppercase;
    margin-bottom: 16px;
    display: block;
  }
  header h1 {
    font-size: clamp(28px, 5vw, 52px);
    font-weight: 800;
    line-height: 1.1;
    background: linear-gradient(135deg, #fff 30%, var(--accent) 70%, var(--accent2) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 16px;
  }
  header p {
    color: var(--text-dim);
    font-size: 15px;
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.7;
  }

  /* Section */
  .section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 36px;
    margin-bottom: 32px;
    position: relative;
    overflow: hidden;
  }
  .section::before {
    content: attr(data-num);
    position: absolute;
    top: -10px;
    right: 24px;
    font-family: 'Space Mono', monospace;
    font-size: 80px;
    font-weight: 700;
    color: rgba(0,229,255,0.04);
    line-height: 1;
  }
  .section-title {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--accent);
    letter-spacing: 3px;
    text-transform: uppercase;
    margin-bottom: 8px;
  }
  .section h2 {
    font-size: 22px;
    font-weight: 700;
    margin-bottom: 24px;
    color: #fff;
  }

  /* PART 1 ‚Äî Token Chunk Slider */
  .slider-container {
    background: var(--surface2);
    border-radius: 12px;
    padding: 28px;
    margin-bottom: 24px;
  }
  .slider-label {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
  }
  .slider-label span {
    font-family: 'Space Mono', monospace;
    font-size: 13px;
    color: var(--text-dim);
  }
  .slider-label .val {
    font-size: 20px;
    font-weight: 700;
    color: var(--accent);
  }
  input[type=range] {
    -webkit-appearance: none;
    width: 100%;
    height: 4px;
    border-radius: 2px;
    background: var(--border);
    outline: none;
    margin-bottom: 24px;
  }
  input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
    box-shadow: 0 0 16px var(--accent);
    transition: box-shadow 0.2s;
  }
  input[type=range]::-webkit-slider-thumb:hover {
    box-shadow: 0 0 24px var(--accent);
  }

  /* Embedding visualization */
  .embed-viz {
    display: grid;
    grid-template-columns: 1fr 60px 1fr;
    gap: 20px;
    align-items: center;
  }
  .chunk-box {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 16px;
    min-height: 120px;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .chunk-label {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    color: var(--text-dim);
    margin-bottom: 4px;
  }
  .token-row {
    display: flex;
    flex-wrap: wrap;
    gap: 3px;
  }
  .token {
    font-size: 9px;
    padding: 2px 6px;
    border-radius: 4px;
    background: rgba(0,229,255,0.1);
    border: 1px solid rgba(0,229,255,0.2);
    color: var(--accent);
    font-family: 'Space Mono', monospace;
    transition: all 0.3s;
  }
  .token.overflow {
    background: rgba(255,107,107,0.1);
    border-color: rgba(255,107,107,0.3);
    color: var(--accent2);
    opacity: 0.6;
  }

  .arrow-box {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
  }
  .arrow-box span {
    font-size: 24px;
    color: var(--accent);
  }
  .arrow-box small {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    color: var(--text-dim);
    text-align: center;
  }

  /* Vector bars */
  .vector-container {
    display: flex;
    gap: 2px;
    align-items: flex-end;
    height: 80px;
  }
  .vec-bar {
    flex: 1;
    border-radius: 3px 3px 0 0;
    transition: all 0.5s ease;
    min-width: 4px;
  }

  /* Metrics */
  .metrics-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-top: 20px;
  }
  .metric {
    background: var(--bg);
    border-radius: 10px;
    padding: 14px;
    text-align: center;
    border: 1px solid var(--border);
    transition: all 0.4s;
  }
  .metric-label {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    color: var(--text-dim);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 6px;
  }
  .metric-value {
    font-size: 22px;
    font-weight: 700;
    transition: color 0.4s;
  }
  .metric-sub {
    font-size: 10px;
    color: var(--text-dim);
    margin-top: 3px;
  }

  /* PART 2 ‚Äî ReAct Agent */
  .react-flow {
    display: flex;
    flex-direction: column;
    gap: 0;
  }
  .react-step {
    display: flex;
    align-items: stretch;
    gap: 20px;
  }
  .step-connector {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 44px;
    flex-shrink: 0;
  }
  .step-icon {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    border: 2px solid;
    flex-shrink: 0;
    z-index: 1;
    position: relative;
  }
  .step-line {
    width: 2px;
    flex: 1;
    min-height: 20px;
    background: linear-gradient(var(--accent), transparent);
    opacity: 0.3;
  }
  .step-content {
    flex: 1;
    padding-bottom: 28px;
  }
  .step-content h4 {
    font-family: 'Space Mono', monospace;
    font-size: 12px;
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 6px;
  }
  .step-content p {
    font-size: 13px;
    color: var(--text-dim);
    line-height: 1.7;
  }
  .step-content .highlight-box {
    background: var(--bg);
    border-left: 3px solid var(--accent4);
    padding: 10px 14px;
    border-radius: 0 6px 6px 0;
    margin-top: 10px;
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--accent4);
    line-height: 1.6;
  }

  /* Context size selector */
  .context-selector {
    display: flex;
    gap: 12px;
    margin: 20px 0;
    flex-wrap: wrap;
  }
  .ctx-btn {
    flex: 1;
    min-width: 120px;
    padding: 14px 16px;
    border-radius: 10px;
    border: 2px solid var(--border);
    background: var(--bg);
    color: var(--text-dim);
    cursor: pointer;
    font-family: 'Space Mono', monospace;
    font-size: 12px;
    text-align: center;
    transition: all 0.3s;
  }
  .ctx-btn:hover { border-color: var(--accent); color: var(--accent); }
  .ctx-btn.active {
    border-color: var(--accent);
    background: rgba(0,229,255,0.08);
    color: var(--accent);
    box-shadow: 0 0 20px rgba(0,229,255,0.1);
  }
  .ctx-btn .ctx-tokens {
    font-size: 22px;
    font-weight: 700;
    display: block;
    margin-bottom: 4px;
    color: inherit;
  }

  /* Agent simulation */
  .agent-sim {
    background: var(--bg);
    border-radius: 12px;
    border: 1px solid var(--border);
    overflow: hidden;
  }
  .sim-header {
    background: var(--surface2);
    padding: 12px 20px;
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--text-dim);
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .sim-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    background: var(--accent3);
    box-shadow: 0 0 8px var(--accent3);
    animation: blink 1.5s infinite;
  }
  @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }
  .sim-body {
    padding: 20px;
    min-height: 160px;
  }
  .sim-line {
    font-family: 'Space Mono', monospace;
    font-size: 12px;
    line-height: 1.8;
    margin-bottom: 4px;
    opacity: 0;
    transform: translateY(4px);
    transition: all 0.3s;
  }
  .sim-line.visible {
    opacity: 1;
    transform: none;
  }
  .sim-line.thought { color: var(--accent4); }
  .sim-line.act { color: var(--accent); }
  .sim-line.obs { color: var(--accent3); }
  .sim-line.error { color: var(--accent2); }
  .sim-line.success { color: var(--accent3); font-weight: 700; }

  /* Summary cards */
  .summary-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 8px;
  }
  .sum-card {
    background: var(--surface2);
    border-radius: 12px;
    padding: 20px;
    border: 1px solid var(--border);
  }
  .sum-card h4 {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 12px;
    color: var(--accent);
  }
  .sum-card ul {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  .sum-card ul li {
    font-size: 13px;
    color: var(--text-dim);
    line-height: 1.6;
    padding-left: 16px;
    position: relative;
  }
  .sum-card ul li::before {
    content: '‚Üí';
    position: absolute;
    left: 0;
    color: var(--accent);
    font-family: 'Space Mono', monospace;
  }

  .verdict {
    background: linear-gradient(135deg, rgba(0,229,255,0.05), rgba(168,255,120,0.05));
    border: 1px solid rgba(0,229,255,0.2);
    border-radius: 14px;
    padding: 28px;
    text-align: center;
    margin-top: 28px;
  }
  .verdict p {
    font-size: 15px;
    line-height: 1.8;
    color: var(--text-dim);
    max-width: 700px;
    margin: 0 auto 12px;
  }
  .verdict strong { color: var(--accent); }

  @media (max-width: 640px) {
    .embed-viz { grid-template-columns: 1fr; }
    .arrow-box span { transform: rotate(90deg); display: block; }
    .metrics-grid { grid-template-columns: 1fr 1fr; }
    .summary-grid { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>
<div class="container">
  <header>
    <span class="tag">The Coca-Cola Company ‚Äî AIEx / Discusi√≥n T√©cnica</span>
    <h1>Tokens, Embeddings<br>& Agentes ReAct</h1>
    <p>Una visualizaci√≥n interactiva para responder: ¬øel tama√±o del chunk afecta la calidad del embedding? ¬øY d√≥nde ocurre la "magia" en ReAct?</p>
  </header>

  <!-- SECTION 1 -->
  <div class="section" data-num="01">
    <div class="section-title">Pregunta 1 de Salvador</div>
    <h2>¬øLa distancia vectorial deber√≠a ser igual sin importar cu√°ntos tokens entran al embedding?</h2>

    <div class="slider-container">
      <div class="slider-label">
        <span>Tama√±o del chunk (tokens)</span>
        <span class="val" id="tokenVal">100</span>
      </div>
      <input type="range" id="tokenSlider" min="50" max="1000" step="50" value="100">

      <div class="embed-viz">
        <div>
          <div class="chunk-label">CHUNK DE TEXTO</div>
          <div class="chunk-box">
            <div class="chunk-label" id="chunkDesc">Texto enfocado ‚Äî un concepto</div>
            <div class="token-row" id="tokenViz"></div>
          </div>
        </div>
        <div class="arrow-box">
          <span>‚Üí</span>
          <small>Encoder<br>dim=50</small>
        </div>
        <div>
          <div class="chunk-label">VECTOR EMBEDDING (dim=50)</div>
          <div class="chunk-box">
            <div class="chunk-label" id="vecDesc">Alta precisi√≥n sem√°ntica</div>
            <div class="vector-container" id="vectorViz"></div>
          </div>
        </div>
      </div>

      <div class="metrics-grid">
        <div class="metric">
          <div class="metric-label">Precisi√≥n Sem√°ntica</div>
          <div class="metric-value" id="precisionVal" style="color: var(--accent3)">96%</div>
          <div class="metric-sub">del embedding</div>
        </div>
        <div class="metric">
          <div class="metric-label">Info. Perdida</div>
          <div class="metric-value" id="lossVal" style="color: var(--accent3)">4%</div>
          <div class="metric-sub">por compresi√≥n</div>
        </div>
        <div class="metric">
          <div class="metric-label">Ruido Sem√°ntico</div>
          <div class="metric-value" id="noiseVal" style="color: var(--accent3)">Bajo</div>
          <div class="metric-sub">diluci√≥n del vector</div>
        </div>
      </div>
    </div>

    <div class="summary-grid">
      <div class="sum-card">
        <h4>La respuesta corta</h4>
        <ul>
          <li>El vector tiene la misma <strong style="color:#fff">dimensi√≥n</strong> siempre (ej. dim=50)</li>
          <li>Pero el <strong style="color:#fff">contenido sem√°ntico</strong> que representa cambia mucho</li>
          <li>M√°s tokens = m√°s informaci√≥n que comprimir = <strong style="color:#fff">mayor p√©rdida</strong></li>
          <li>La distancia coseno entre vectores s√≠ var√≠a con chunks distintos</li>
        </ul>
      </div>
      <div class="sum-card">
        <h4>Analog√≠a</h4>
        <ul>
          <li>Es como tomar una <strong style="color:#fff">foto de una habitaci√≥n</strong> vs una ciudad entera</li>
          <li>Ambas fotos son del mismo tama√±o (misma resoluci√≥n)</li>
          <li>Pero la foto de la ciudad pierde detalles cruciales</li>
          <li>El "significado" de cada pixel es distinto en cada caso</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- SECTION 2 -->
  <div class="section" data-num="02">
    <div class="section-title">Pregunta 2 de Salvador</div>
    <h2>¬øLa "magia" del agente ReAct ocurre al observar y sintetizar?</h2>

    <div class="react-flow">
      <div class="react-step">
        <div class="step-connector">
          <div class="step-icon" style="border-color:var(--accent4); background:rgba(255,217,61,0.1)">üß†</div>
          <div class="step-line"></div>
        </div>
        <div class="step-content">
          <h4 style="color:var(--accent4)">Thought ‚Äî Razonamiento</h4>
          <p>El agente genera un razonamiento interno sobre qu√© necesita saber para responder. No act√∫a a√∫n.</p>
          <div class="highlight-box">Thought: "El usuario pregunta sobre disponibilidad de Coca-Cola Classic 600ml en OXXO Reforma. Necesito consultar el sistema de inventario para la zona de distribuci√≥n correcta."</div>
        </div>
      </div>

      <div class="react-step">
        <div class="step-connector">
          <div class="step-icon" style="border-color:var(--accent); background:rgba(0,229,255,0.1)">‚ö°</div>
          <div class="step-line"></div>
        </div>
        <div class="step-content">
          <h4 style="color:var(--accent)">Act ‚Äî Acci√≥n / RAG</h4>
          <p>El agente lanza una b√∫squeda en la base vectorial. Aqu√≠ importa el tama√±o del chunk: chunks peque√±os ‚Üí embedding m√°s preciso ‚Üí recupera el chunk correcto.</p>
          <div class="highlight-box">Action: search_vector_db("disponibilidad Coca-Cola Classic 600ml OXXO Reforma")
‚Üí Retrieves chunk con embedding de alta precisi√≥n</div>
        </div>
      </div>

      <div class="react-step">
        <div class="step-connector">
          <div class="step-icon" style="border-color:var(--accent3); background:rgba(168,255,120,0.1)">üëÅÔ∏è</div>
          <div class="step-line" style="background:linear-gradient(var(--accent3), transparent)"></div>
        </div>
        <div class="step-content">
          <h4 style="color:var(--accent3)">Observation ‚Äî La s√≠ntesis ‚òÖ</h4>
          <p>Aqu√≠ Salvador tiene raz√≥n: <strong style="color:#fff">la magia ocurre aqu√≠</strong>. El agente lee la observaci√≥n y decide si tiene suficiente informaci√≥n o necesita otro ciclo.</p>
          <div class="highlight-box" style="border-color:var(--accent3); color:var(--accent3)">Observation: "CEDIS Reforma ‚Äî SKU CCL600 ‚Äî 1,240 unidades, 3 rutas activas"
‚Üí Si el chunk era de 1000 tokens con ruido sem√°ntico,
   el agente puede confundirse y pedir m√°s datos innecesarios.</div>
        </div>
      </div>

      <div class="react-step">
        <div class="step-connector">
          <div class="step-icon" style="border-color:var(--accent2); background:rgba(255,107,107,0.1)">‚úÖ</div>
        </div>
        <div class="step-content">
          <h4 style="color:var(--accent2)">Final Answer</h4>
          <p>Si la observaci√≥n fue limpia (chunk peque√±o, embedding preciso), el agente responde en 1-2 ciclos. Con chunks grandes y ruidosos puede entrar en bucles.</p>
        </div>
      </div>
    </div>

    <div style="border-top: 1px solid var(--border); padding-top: 24px; margin-top: 8px;">
      <div class="section-title" style="margin-bottom:12px">Simula el impacto del tama√±o de chunk en el agente</div>
      <div class="context-selector">
        <button class="ctx-btn active" onclick="runSim(50)" data-size="50">
          <span class="ctx-tokens">50</span>tokens ‚Äî Chunk peque√±o
        </button>
        <button class="ctx-btn" onclick="runSim(100)" data-size="100">
          <span class="ctx-tokens">100</span>tokens ‚Äî √ìptimo
        </button>
        <button class="ctx-btn" onclick="runSim(500)" data-size="500">
          <span class="ctx-tokens">500</span>tokens ‚Äî Grande
        </button>
        <button class="ctx-btn" onclick="runSim(1000)" data-size="1000">
          <span class="ctx-tokens">1000</span>tokens ‚Äî Muy grande
        </button>
      </div>

      <div class="agent-sim">
        <div class="sim-header">
          <div class="sim-dot"></div>
          AGENTE ReAct ‚Äî Simulaci√≥n de ciclos de razonamiento
        </div>
        <div class="sim-body" id="simBody">
        </div>
      </div>
    </div>
  </div>

  <!-- Verdict -->
  <div class="verdict">
    <div class="section-title" style="margin-bottom:12px">Conclusi√≥n para el equipo</div>
    <p>El embedding de dim=50 siempre produce el mismo <strong>tama√±o de vector</strong>, pero el <strong>significado comprimido</strong> depende brutalmente del tama√±o del chunk. Un chunk de 1000 tokens en dim=50 pierde ~92% de la informaci√≥n sem√°ntica.</p>
    <p>Y Salvador tiene raz√≥n: la <strong>s√≠ntesis en ReAct</strong> es tan importante como la recuperaci√≥n. Un mal embedding trae el chunk equivocado ‚Üí el agente alucina o entra en bucles. Son dos problemas distintos pero encadenados.</p>
    <p style="font-family:'Space Mono',monospace; font-size:12px; color:var(--accent); margin-top:8px">
      ‚úì Chunks peque√±os ‚Üí embeddings precisos ‚Üí observaciones limpias ‚Üí ReAct eficiente
    </p>
  </div>
</div>

<script>
// ============================
// TOKEN SLIDER LOGIC
// ============================
const sampleWords = ["Coca-Cola","Classic","sabor","original","f√≥rmula","caramelo","color","gas","az√∫car","distribuidor","botella","lata","vidrio","PET","refresco","FEMSA","OXXO","planta","embotelladora","Sprite","Fanta","Powerade","Fuze","Tea","Ciel","agua","Del","Valle","Minute","Maid","mercado","ventas","inventario","SKU","producto","M√©xico","precio","litro","cami√≥n","ruta","almac√©n","distribuci√≥n","consumidor","portafolio","c√≥digo","barras","categor√≠a","bebida","campa√±a","marca","global","pedido","cliente","promoci√≥n","temporada","navidad","verano","Copa","Mundial","patrocinio","empaque","retornable","desechable","tapa","etiqueta","contenido","neto","mililitros","calor√≠as","ingredientes","carbonataci√≥n","extracto","cola","vainilla","canela","naranja","promotor","preventista","ejecutivo","territorio","zona","regi√≥n","nacional","cadena","fr√≠o","temperatura","almacenamiento","rotaci√≥n","caducidad","lote","producci√≥n","l√≠nea","turno","supervisor","estrategia","objetivo","volumen","market","share","competencia","Pepsi","Big","Cola","CEDIS","Arca","embotellado","multiempaque","display","anaquel","frente","facing","planograma","sellout","offtake"];

const slider = document.getElementById('tokenSlider');
const tokenVal = document.getElementById('tokenVal');

function updateEmbedding(tokens) {
  tokenVal.textContent = tokens;

  // Token visualization
  const tviz = document.getElementById('tokenViz');
  tviz.innerHTML = '';
  const showTokens = Math.min(tokens, 40);
  const overflowFrom = 30;
  for(let i = 0; i < showTokens; i++) {
    const t = document.createElement('span');
    t.className = 'token' + (i >= overflowFrom ? ' overflow' : '');
    t.textContent = sampleWords[i % sampleWords.length];
    tviz.appendChild(t);
  }
  if(tokens > 40) {
    const t = document.createElement('span');
    t.className = 'token overflow';
    t.textContent = `+${tokens-40} m√°s...`;
    tviz.appendChild(t);
  }

  // Vector visualization
  const vviz = document.getElementById('vectorViz');
  vviz.innerHTML = '';
  const compressionFactor = Math.min(tokens / 50, 20);
  const hues = [180, 195, 160, 200, 175, 190, 165, 185, 170, 195];

  for(let i = 0; i < 50; i++) {
    const bar = document.createElement('div');
    bar.className = 'vec-bar';
    // More compression = more chaotic/uniform bars (diluted)
    const idealHeight = 20 + Math.sin(i * 0.8) * 30 + Math.random() * 20;
    const dilution = Math.min(compressionFactor / 20, 1);
    const height = idealHeight * (1 - dilution * 0.6) + dilution * 30;
    bar.style.height = height + 'px';
    const hue = hues[i % hues.length];
    const sat = Math.max(20, 80 - dilution * 60);
    const lit = Math.max(30, 55 - dilution * 20);
    bar.style.background = `hsl(${hue}, ${sat}%, ${lit}%)`;
    vviz.appendChild(bar);
  }

  // Metrics
  const precision = Math.max(5, Math.round(100 - (Math.log(tokens/50) * 20)));
  const loss = 100 - precision;
  const noise = tokens <= 100 ? 'Bajo' : tokens <= 300 ? 'Medio' : tokens <= 600 ? 'Alto' : 'Muy Alto';
  const noiseColor = tokens <= 100 ? 'var(--accent3)' : tokens <= 300 ? 'var(--accent4)' : 'var(--accent2)';
  const precColor = tokens <= 100 ? 'var(--accent3)' : tokens <= 300 ? 'var(--accent4)' : 'var(--accent2)';

  document.getElementById('precisionVal').textContent = precision + '%';
  document.getElementById('precisionVal').style.color = precColor;
  document.getElementById('lossVal').textContent = loss + '%';
  document.getElementById('lossVal').style.color = loss < 20 ? 'var(--accent3)' : loss < 50 ? 'var(--accent4)' : 'var(--accent2)';
  document.getElementById('noiseVal').textContent = noise;
  document.getElementById('noiseVal').style.color = noiseColor;

  // Descriptions
  const chunkDesc = document.getElementById('chunkDesc');
  const vecDesc = document.getElementById('vecDesc');
  if(tokens <= 100) {
    chunkDesc.textContent = 'Texto enfocado ‚Äî 1-2 conceptos';
    vecDesc.textContent = '‚úì Alta precisi√≥n sem√°ntica';
    vecDesc.style.color = 'var(--accent3)';
  } else if(tokens <= 300) {
    chunkDesc.textContent = 'Texto moderado ‚Äî varios conceptos';
    vecDesc.textContent = '‚ö† Precisi√≥n media ‚Äî algo de ruido';
    vecDesc.style.color = 'var(--accent4)';
  } else {
    chunkDesc.textContent = `Texto extenso ‚Äî m√∫ltiples temas mezclados`;
    vecDesc.textContent = '‚úó Vector diluido ‚Äî sem√°ntica ambigua';
    vecDesc.style.color = 'var(--accent2)';
  }
}

slider.addEventListener('input', () => updateEmbedding(parseInt(slider.value)));
updateEmbedding(100);

// ============================
// REACT SIMULATION
// ============================
const scenarios = {
  50: [
    {type:'thought', text:'Thought: Necesito info sobre stock de Coca-Cola Classic 600ml en OXXO zona Reforma...'},
    {type:'act', text:'Action: search_vector_db("Coca-Cola Classic 600ml stock OXXO Reforma") ‚Üí Chunk preciso recuperado'},
    {type:'obs', text:'Observation: "CEDIS Reforma ‚Äî SKU CCL600 ‚Äî 1,240 unidades, 3 rutas activas" ‚Üê chunk enfocado, limpio'},
    {type:'thought', text:'Thought: Tengo el dato exacto de inventario. Chunk peque√±o = se√±al limpia.'},
    {type:'success', text:'‚úì Final Answer en 1 ciclo ‚Äî Eficiencia m√°xima'},
  ],
  100: [
    {type:'thought', text:'Thought: Necesito info sobre disponibilidad de Coca-Cola 600ml en Reforma...'},
    {type:'act', text:'Action: search_vector_db("Coca-Cola 600ml Reforma disponibilidad") ‚Üí Chunk √≥ptimo recuperado'},
    {type:'obs', text:'Observation: "CEDIS Reforma ‚Äî SKU CCL600 ‚Äî 1,240 unidades disponibles, entrega en 2h." ‚Üê claro'},
    {type:'thought', text:'Thought: Informaci√≥n suficiente y precisa.'},
    {type:'success', text:'‚úì Final Answer en 1 ciclo ‚Äî Muy eficiente'},
  ],
  500: [
    {type:'thought', text:'Thought: Necesito info sobre stock de Coca-Cola en zona Reforma...'},
    {type:'act', text:'Action: search_vector_db("Coca-Cola Reforma") ‚Üí Chunk grande recuperado (500 tokens)'},
    {type:'obs', text:'Observation: "...Coca-Cola, Fanta, Sprite, Powerade, Ciel... m√∫ltiples SKUs... precios mayoreo... rutas norte/sur/centro... OXXO, 7-Eleven, Walmart, Soriana... historial de pedidos..." ‚Üê ruido'},
    {type:'thought', text:'Thought: Hay datos de Coca-Cola pero mezclados con otros productos y canales. ¬øCu√°l SKU espec√≠fico necesito?'},
    {type:'act', text:'Action: search_vector_db("SKU CCL600 inventario actual Reforma") ‚Üí 2do intento'},
    {type:'obs', text:'Observation: "CEDIS Reforma ‚Äî CCL600 ‚Äî 1,240 unidades" ‚Üê encontrado en 2do ciclo'},
    {type:'error', text:'‚ö† Final Answer en 2 ciclos ‚Äî 2x m√°s lento por chunk ruidoso'},
  ],
  1000: [
    {type:'thought', text:'Thought: Necesito info sobre stock de Coca-Cola Classic en zona Reforma...'},
    {type:'act', text:'Action: search_vector_db("Coca-Cola Reforma") ‚Üí Chunk de 1000 tokens recuperado'},
    {type:'obs', text:'Observation: "...portafolio completo TCCC, embotelladoras FEMSA y Arca, precios 2024-2025, rutas de distribuci√≥n nacional, estad√≠sticas de ventas por canal, hist√≥ricos de campa√±as de marketing, participaci√≥n de mercado, coordenadas de todos los CEDIS, reportes de calidad, certificaciones ISO..." ‚Üê muy ruidoso'},
    {type:'thought', text:'Thought: El chunk contiene demasiado contexto irrelevante. No puedo identificar el inventario espec√≠fico de CCL600. Necesito reformular.'},
    {type:'act', text:'Action: search_vector_db("inventario CCL600 disponible actual") ‚Üí 2do intento'},
    {type:'obs', text:'Observation: Otro chunk de 1000 tokens igualmente ruidoso. Mezcla datos de todo el portafolio ‚Üê ambig√ºedad sem√°ntica'},
    {type:'thought', text:'Thought: El embedding no distingue entre SKUs del portafolio. Intentar√© con t√©rminos m√°s espec√≠ficos...'},
    {type:'act', text:'Action: search_vector_db("CEDIS Reforma Classic 600ml unidades disponibles") ‚Üí 3er intento'},
    {type:'obs', text:'Observation: "...CEDIS Reforma...SKU CCL600...1,240 unidades..." ‚Üê finalmente encontrado'},
    {type:'error', text:'‚úó Final Answer en 3 ciclos ‚Äî Ineficiente, costoso, mayor riesgo de alucinaci√≥n'},
  ]
};

function runSim(size) {
  // Update buttons
  document.querySelectorAll('.ctx-btn').forEach(b => {
    b.classList.toggle('active', parseInt(b.dataset.size) === size);
  });

  const body = document.getElementById('simBody');
  body.innerHTML = '';

  const lines = scenarios[size];
  lines.forEach((line, i) => {
    const div = document.createElement('div');
    div.className = `sim-line ${line.type}`;
    div.textContent = line.text;
    body.appendChild(div);
    setTimeout(() => div.classList.add('visible'), i * 300 + 100);
  });
}

runSim(50);
</script>
</body>
</html>
